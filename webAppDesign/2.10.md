# Web应用开发实录前端篇 管理后台前端 后台全局校验是否登录

我们完成了顶部通栏以及左侧菜单栏的工作，不知道您有没有发现一个问题，那就是在我们不登录，直接输入管理后台的相应地址的时候是可以打开后台的。

我们之前在封装的 `@/tool/api.js` 文件中，针对请求接口 `401` 错误时，会跳转到登录页面。但是，如果我页面不请求接口呢？所以，我们需要全局来判断一下。

我们的后台主路由视图文件是 `@/frame/main_frame.vue`，我们可以通过这个文件来进行处理。

一般来说，应该设计一个检测是否登录的测试接口。不过一般后端都不会去写这个接口，因为无论啥接口都可以用来检测，就没有必要单独写一个了。所以我选择使用一个比较轻量的接口来测试一下，就是我们的 `site` 接口，获取站点信息的。

## 完成全局校验登录

我们编辑 `@/frame/main_frame.vue` 文件，将其中的 `script` 部分代码替换为以下代码：

```js
// 引入顶部通栏组件
import TopLine from '@/coms/frame/main_frame/top_line.vue'
// 引用菜单栏组件
import Nav from '@/coms/frame/main_frame/nav.vue'
export default {
  // 注册组件
  components: { TopLine, Nav },
  created () {
    // 组件创建时执行
    this.testLogin()
  },
  methods: {
    testLogin () {
      // 通过 site 接口判断是否登录
      this.$api.get('site', null, () => {})
    }
  }
}
```

逻辑非常简单，请求管理后台的所有需要登录的页面，一定会通过 `main_frame.vue` 这个文件，那么这个文件在创建的时候，就会去先判断是否登录。

如果没有登录的话，我们封装的 `api.js` 会自动跳转到登录页面，也就不用我们管了。

当然，如果是已经登录的状态，但是长时间没有操作，被强制登出之后，如果不操作页面，则还是会看上去保持登录状态的。但是，只要操作一下，点击一个页面请求任何一个接口，就会被强制退出到登录页面。

> 本文由 FungLeo 原创，未经书面许可，严禁转载。


