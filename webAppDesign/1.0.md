#  Web应用开发实录后端篇 设计后端结构 确定技术选型

在产品设计完产品，前后端约定好接口之后，我们就要开始我们的开发工作了。一般来说，每一个公司都有自己的技术积累，会在接到项目之后，找一个最接近自己擅长的技术栈去开发项目。

但是，我在本书中假设，什么技术积累都没有，完全是从零开始打造。

常见的 `web` 后端开发语言有 `java`、 `php`、 `.net` 等等。尤其是 `php`，被戏称为最好的语言。而在本书中，我们选择 `python3.6` 语言作为开发语言。

为什么选择 `python` 呢？人生苦短，我用 `python`。这是一个适合快速开发项目的语言，我学习并使用 `python` 开发项目的经验就是，这是一个基本无脑的语言，你不必在意语言本身，你只需要去考虑你的业务即可。

而其他的语言，要考虑的东西甚多，所以，我喜欢 `python`。当然，我并不推荐一个公司在全是 `java` 或者 `php` 工程师的情况下，去转技术栈，选择 `python` 语言。但是我建议作为产品，或者公司的技术领导，以及公司的前端工程师，都要在一定程度上掌握 `python` 语言。因为它非常容易学习，以至于你基本不需要太费力气就可以掌握。而当你掌握了 `python` 语言之后，其他的语言是相通的。也就是说，虽然你的公司使用的是其他语言，但是作为前端或者产品会 `python` 语言，那么公司的后端工程师想要表达的一些概念，或者阐述的某些技术点，你都能够理解。

这非常重要。我见过太多的后端工程师利用自己的专业知识以及其他技术岗位上的同事对后端的不了解，瞎忽悠。这就是所谓的外行领导内行容易吃亏的地方。尤其是前端，基本是属于被后端压着打的感觉。这也就是为什么这几年前端的 `nodejs` 发展如此迅猛的原因。就是因为前端实在受不了后端，希望自己单干的原因。

所以，我在本书中谈 `python` 并不是希望各位看官都使用 `python` 作为后端开发的主力语言，而是希望借由我的阐述，让大家都对后端有一定的了解。

好，话不多说，书归正传。我们确定我们的技术选型为：

- 开发语言 `python3.6`
- `web` 服务框架 `sanic`
- 数据库 `sqlite`
- `ORM` 数据库操作类库 `sqlalchemy`
- 加密解密 `RSA` 非对称加密

这里我们逐一解释以下。

> 在开始本章阅读时，如果您有其他语言的编程基础，可以花上几分钟去阅读一下 `python` 语言的基本规范。因为这个语言比较简单，大概花半个小时左右，就可以有一个大概的了解。
> 
> 廖雪峰的 `python` 教程地址： https://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000
> 
> 中文 `python` 菜鸟教程：http://www.runoob.com/python/python-tutorial.html
> 
> 如果您没有编程基础，只是想了解一下，那么代码就只要看一个大概其就可以了，除了极个别比较复杂的代码外，一般的代码的阅读理解还是不困难的。

## python web 服务框架 sanic

在 `python` 语言中，比较老的框架有 `django` 和 `flask` 框架。这两个框架都比较成熟，中文资料也相对来说比较多。但是，我个人不太喜欢 `django` 框架。因为这个框架比较重。

我喜欢的任何都是都是看一眼就会，你别让我先学习个几天才会写一个 `hello world`，那我是受不了的。而 `django` 正是这样的一个类型的框架，重，规矩多，我受不了。正如我写任何后端语言都只使用 `vim` 编辑器一样，别一上来就给我扔一个 `IDE` 编辑器，我啥都没干呢，先花几天学习编辑器实在是蛋疼。

![日常开发桌面](https://raw.githubusercontent.com/fengcms/articles/master/image/c3/83ba662faede707748707a41dc93cc.jpg)

上图是我的日常开发状态。

`flask` 框架对于我来说，就是一个非常友好的框架，比较简单而灵活。

> 选择一个重的框架或者轻的框架，是根据不同的业务需求来的。我只是表达我的个人喜好，绝对没有其他含义，请不要受我的文词误导。因为我是一个自由而又散漫的人，受不了规规矩矩。另外，作为主力开发，使用一个称手的 `IDE` 可以大幅提高你的工作效率。我用 `vim` 纯粹是因为我今天写写这个，明天写写那个，总不能电脑上装一堆的 `IDE` 吧，所以一入 `vim` 深似海，从此 `IDE` 是路人了。
> 
> 我表达我的观念，看官不必完全相信。看官绝对拥有完全的独立思维，知道我的表达哪些是适合自己的，哪些是不适合自己的。如果我的文字能够对你有一点点帮助，那是最好的。看到不合意处，骂一句，这作者真是一个傻X，也是非常合适的。

我这边推荐的是 `sanic` 框架，因为这个框架借鉴了很多 `flask` 的设计理念。我比较喜欢，但这不是最重要的。最终要的是 `sanic` 比 `flask` 要快很多。

`sanic` 的 `github` 仓库地址是：https://github.com/channelcat/sanic

`sanic` 是一个异步的，基于 `python3.5+` 的，速度嗷嗷快的 `web` 服务框架。下面，我们来放一个入门示例：

```python
from sanic import Sanic
from sanic.response import json

app = Sanic()

@app.route('/')
async def test(request):
    return json({'hello': 'world'})

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=8000)
```

如上，稍微有一点编程基础，一眼就能看明白。

## python orm 数据库操作类库 sqlalchemy

操作数据库，我们一般选择使用 `sql` 语句来进行。那我为什么又推荐 `ORM` 方式来进行呢？

如果你的项目的数据库一旦确定之后是绝对不会发生改变的，并且，你的团队中有 `SQL` 高手能够写出高效并且绝对安全的 `SQL` 语句，那么，就是完全没有必要使用 `ORM` 库类来写项目的。

很明显，我不是一个 `SQL` 高手，所以，我选择 `ORM`。

个人认为 `ORM` 相比 `SQL` 有以下几个优点：

1. 面向对象编写，更加适合普通工程师的思维。
2. 同一语句适合多种数据库，代码更加灵活。
3. 追加条件，相比 `SQL` 实现更加简单。
4. `ORM` 输出的 `SQL` 语句性能一般都不低，但不是最优。
5. 避免出现不安全的查询。

所以，在你的项目中，到底要不要使用 `ORM` 完全是根据自己的团队技术实力以及项目要求做出的技术选择。

在 `python` 语言中， `sqlalchemy` 是一个大名鼎鼎的 `ORM` 库。选择它，完全是因为它就是主流。

其官方网站是：http://www.sqlalchemy.org/ 。网站是英文的，它的中文资料有，但是不健全。如果有英文阅读能力，建议阅读英文官方文档。如果没有，只能找中文的二手资料了。

![sqlalchemy 官方网站截图](https://raw.githubusercontent.com/fengcms/articles/master/image/0f/897eeb1c19cb182b7343f4973c13cd.jpg)


不过，一般的使用，百度搜索的中文资料也是没有问题的。

## RSA 非对称加密

在我设计的这个小型的文章系统中，涉及到需要加密的信息也只有一个管理员密码而已。早年我们在系统中常常使用 `MD5` 加密。这里需要澄清一下，`MD5` 并不是一个加密，而只是取哈希值而已。所以，你现在还在使用 `MD5` 保存用户的密码，那绝对是不可靠的。一旦被拖库，所有的密码信息泄露无疑。

我个人推荐使用 `RSA` 非对称加密。它的加密是由公钥进行加密，解密是由配对的私钥进行解密。在没有配对私钥的情况下，是无法解密的。安全性非常高。

可是，它也有缺点，就是因为加密强度较高，所以运行较慢，不适合加密大量数据。但是用在用户密码上，是非常合适的。

如果是用于大量数据的加密解密，建议使用 `DES` 对称加密和 `RSA` 非对称加密结合的方式进行处理。这个相关资料，请自行搜索查询，本书中不会涉及到这部分内容。

好了，技术选型已经确定，下面我们要正式进入开发模式了。

> 本文由 FungLeo 原创，未经书面许可，严禁转载。

